# **Домашнее задание 5: Временная когерентность масок и Video Object Segmentation**

### **Цель**

Освоить практические методы видео-сегментации, изучить способы стабилизации масок во времени, применить механизмы переноса масок через оптический поток и оценить влияние временных артефактов на итоговое качество сегментации.
Студент реализует **один из двух** инженерных мини-проектов: (A) построение системы уменьшения мерцания масок для кадр-по-кадр сегментации или (B) разработка учебной системы semi-VOS с перенесением маски во времени и анализом ошибок.

---

# **Вариант A: Система временной стабилизации масок (anti-flicker)**

### **Задание**

1. Выбрать любой ролик с движущимся объектом.
   Допускается использование пользовательского видео или произвольного доступного датасета.

2. Прогнать видеоряд через любую **предобученную модель сегментации по кадрам** (Mask R-CNN, Mask2Former, DeepLabv3 или другая), получив последовательность бинарных масок.

3. Реализовать систему **оценки временной нестабильности** масок:
   измерить покадровую разницу, например через IoU соседних масок, либо метрику «маска меняется там, где объект не менялся».

4. Реализовать **сглаживание масок во времени** одним из методов:
   – сглаживание вероятностных карт (усреднение окна по времени);
   – медианное сглаживание по последовательности масок;
   – сглаживание с весами, зависящими от величины локального движения.

5. Построить итоговые маски после сглаживания.

6. Сравнить качество «до/после» через собственные визуализации и метрики нестабильности.

7. Подготовить короткое описание инженерного решения:
   почему выбран именно этот метод, какие параметры оказались чувствительными, где сглаживание помогает, а где ухудшает сегментацию.

---

# **Вариант B: Мини-система Video Object Segmentation с переносом маски**

### **Задание**

1. Выбрать любое видео с хорошо различимым объектом.
   На первом кадре задать **исходную маску** вручную или с помощью модели (например, SAM).

2. Реализовать **перенос маски вперёд во времени** через оптический поток:
   – вычислить оптический поток между соседними кадрами (Farnebäck или Lucas–Kanade);
   – перенести пиксели маски из кадра *t* в кадр *t+1*;
   – корректно обработать пустые пиксели или пропуски.

3. Сформировать последовательность масок, полученных переносом, и визуально оценить ошибки переноса: разрывы, смещения, артефакты от motion blur, изменения масштаба объекта.

4. Добавить **обратное сглаживание по времени**:
   использовать информацию из будущего кадра (маска *t+1*) для уточнения маски *t*, реализовав простейший двухсторонний проход: forward pass + backward pass.

5. Сравнить четыре варианта:
   – никакого переноса (исходная маска только на кадре 0);
   – прямой перенос;
   – перенос + сглаживание;
   – перенос + сглаживание + постобработка морфологическими фильтрами.

6. Подготовить визуальный отчёт: траектория объекта в маске, поведение границ, стабильность формы.

7. Сделать инженерный вывод:
   насколько перенос маски помогает, где ломается, какие эффекты происходят при больших движениях и окклюзиях.

---

# **Требования к сдаче**

Репозиторий на GitHub:

* Папка `src/` или ноутбук `.ipynb` с реализацией выбранного варианта.
* Чёткое описание всех шагов в `README.md`:
  – краткая структура пайплайна,
  – использованные модели,
  – параметры сглаживания / переноса масок,
  – ключевые наблюдения.
* Визуальные примеры:
  – для варианта A: карты нестабильности, примеры «до/после», график IoU между кадрами;
  – для варианта B: покадровые маски, примеры корректного переноса, примеры провалов.
* Короткий технический вывод:
  чему мешает мерцание масок и когда перенос маски улучшает качество.

---

# **Критерии оценки**

| Баллы | Критерий                                                                 |
| ----- | ------------------------------------------------------------------------ |
| 0–3   | Реализованы все этапы выбранного варианта (A или B).                     |
| 0–3   | Код чистый, корректный, воспроизводимый.                                 |
| 0–2   | Анализ: разбор ошибок, графики стабильности, обоснование выбора методов. |
| 0–2   | Репозиторий: аккуратность, наличие визуализаций и качественного README.  |

**Максимум: 10 баллов.**

---

