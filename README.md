# **Вариант A: Система временной стабилизации масок (anti-flicker)**

В качестве модели была выбрана Mask R-CNN

Пайплайн
1) Исходное видео было обработано моделью с выходом масок вероятностей и бинарных масок в трешолдом 0.5
2) В качестве сглаживания было выбраное оконное сглаживание маской вероятности с шириной k=2 и трешолдом 0.5
Обе маски была наложены на исходное изображение. Красная - выход модели, синяя - стабилизация
![img.png](/report_src/img.png)

Были посчитаны метрики IoU на обоих вариантах, получены средние значения

IoU mean BEFORE: 0.865,

IoU mean AFTER: 0.902,

также построен timeline изменения этих метрик
![img_1.png](/report_src/img_1.png)

Далее была отсмотрена анимация с наложением соотвествующих масок и стало заметно, что 
,что при резких движениях, маска стабилизации не успевает поменяться с текущим сглаживанием. При колебаниях объекта на одном месте она становится неточной, захватывает область шире, чем нужно. 
Поэтому  введём метрику разницы IoS исходного клипа и сглаженного, хотим её уменьшить, чтобы запретить маски сглаживания захватывать ненужную область

3) Для различных параметров сглаживания построены timline изменения IoU и посчитаны метрики diff и IoU mean
![img_2.png](/report_src/img_2.png)
![img_3.png](/report_src/img_3.png)
![img_4.png](/report_src/img_4.png)
![img_5.png](/report_src/img_5.png)


Интересующие метрики

![img_6.png](/report_src/img_6.png)!

k=2 bs=False thr=0.6 итоговый выбор, так как наименьший diff с исходной маской, по графикам действительно закрывает большие разрывы, и  по среднему IoU лучше, чем без сглаживания (0.884 vs 0.865).
4) Проведена ещё одна визуальная проверка, но уже с анимацией 